# @高级生成 使用说明

## 🚀 功能介绍

**@高级生成** (Advanced Generation) 是EduAgent智教创想的核心功能之一，它能够根据您提供的教案主题，自动分析模板中的所有占位符，并使用AI生成高质量、专业的教学内容，最终输出一份完整的教案文档。

### ✨ 核心特性

1. **智能识别** - 自动扫描模板中的所有 `{{placeholder}}` 占位符
2. **AI生成** - 为每个占位符生成专业、详细的教学内容
3. **自动填充** - 将生成的内容精准填充到模板对应位置
4. **格式保持** - 严格保持原始Word文档的表格、Logo、字体和布局
5. **一键导出** - 生成独立的完整教案文件

---

## 📋 支持的占位符（51个）

### 基本信息（4个）
- `{{course_name}}` - 课程名称
- `{{chapter_section}}` - 授课章节
- `{{class_name}}` - 授课班级  
- `{{teacher_name}}` - 授课教师

### 教学目标（3个）
- `{{ideological_goals}}` - 思政育人目标
- `{{knowledge_goals}}` - 知识目标
- `{{ability_goals}}` - 能力目标

### 教学重难点（4个）
- `{{teaching_focus}}` - 教学重点
- `{{teaching_difficulty}}` - 教学难点
- `{{focus_solutions}}` - 重点解决措施
- `{{difficulty_solutions}}` - 难点解决措施

### 教学方法与资源（4个）
- `{{teaching_methods}}` - 教学方法
- `{{learning_methods}}` - 学法指导
- `{{teaching_resources}}` - 教学资源
- `{{ideological_elements}}` - 思政元素融入点

### 教学过程 - 各环节（36个）

每个教学环节包含4个字段：
- `_content` - 环节内容
- `_intention` - 设计意图
- `_teacher` - 教师活动
- `_student` - 学生活动

支持的环节：
1. **预习** (`preview_`)
2. **导入** (`introduction_`)
3. **讲授** (`teaching_`)
4. **自主学习** (`self_learning_`)
5. **课堂练习** (`practice_`)
6. **成果展示** (`presentation_`)
7. **拓展延伸** (`extension_`)
8. **课堂小结** (`evaluation_`)
9. **作业布置** (`homework_`)

---

## 💻 使用方法

### 方式1：命令行工具

```bash
# 基本用法
python advanced_gen.py "教案主题"

# 示例
python advanced_gen.py "Python列表推导式"
python advanced_gen.py "市场营销中的SWOT分析"
python advanced_gen.py "数据库的事务管理"
```

### 方式2：API调用

```bash
# POST请求
curl -X POST http://localhost:5025/api/advanced-generate \
  -H "Content-Type: application/json" \
  -d '{
    "topic": "Python列表推导式"
  }'

# 下载生成的文件
curl -O http://localhost:5025/api/advanced-generate/download/Python列表推导式_教案_已完成.docx
```

### 方式3：Python代码

```python
import asyncio
from core.advanced_generator import AdvancedLessonGenerator
from core.agent import UniversityCourseAgent
from config.settings import DASHSCOPE_API_KEY

async def main():
    # 初始化AI代理
    agent = UniversityCourseAgent(api_key=DASHSCOPE_API_KEY)
    
    # 创建生成器
    generator = AdvancedLessonGenerator(agent=agent)
    
    # 执行生成
    success, result = await generator.generate("Python列表推导式")
    
    if success:
        print(f"✅ 生成成功: {result}")
    else:
        print(f"❌ 生成失败: {result}")

asyncio.run(main())
```

---

## 🎯 工作流程

```
1. 用户输入
   ↓
   "@高级生成 Python列表推导式"

2. 分析模板
   ↓
   扫描 标注教案.docx
   识别所有 {{placeholder}} 占位符
   找到 51 个占位符

3. AI生成内容
   ↓
   第一组：生成基本信息
   - {{course_name}} → "Python程序设计"
   - {{chapter_section}} → "第5章 数据结构"
   - {{teacher_name}} → "张老师"
   
   第二组：生成教学目标
   - {{knowledge_goals}} → "1. 理解列表推导式的基本语法..."
   - {{ability_goals}} → "1. 能够使用列表推导式简化代码..."
   
   第三组：生成教学方法
   - {{teaching_methods}} → "讲授法、演示法、练习法"
   
   第四组：生成教学过程（36个字段）
   - {{preview_content}} → "预习Python官方文档..."
   - {{introduction_content}} → "通过对比for循环..."
   - ...

4. 填充模板
   ↓
   打开 标注教案.docx
   遍历所有段落和表格
   替换 {{placeholder}} → 生成的内容
   保持原有格式

5. 输出文件
   ↓
   Python列表推导式_教案_已完成.docx
```

---

## 📊 生成示例

### 输入
```
@高级生成 数据库的事务管理
```

### 输出（部分展示）

**{{knowledge_goals}}** 生成结果：
```
1. 理解事务的ACID特性（原子性、一致性、隔离性、持久性）
2. 掌握事务的基本操作（BEGIN、COMMIT、ROLLBACK）
3. 了解并发控制机制（锁机制、MVCC）
4. 熟悉事务隔离级别及其应用场景
5. 理解死锁的概念及预防策略
```

**{{teaching_focus}}** 生成结果：
```
重点是事务的ACID特性及其在实际应用中的体现。通过具体案例，
让学生理解为什么需要事务，以及事务如何保证数据的一致性和可靠性。
特别强调原子性和隔离性在多用户并发环境下的重要性。
```

**{{introduction_content}}** 生成结果：
```
通过银行转账案例引入：假设张三向李四转账1000元，这个操作
包含两个步骤：1) 从张三账户扣除1000元，2) 向李四账户增加1000元。
提问：如果第一步成功，第二步失败会怎样？引导学生思考数据一致性
问题，自然引出事务的概念。
```

---

## ⚙️ 配置选项

### 自定义模板路径

```python
# 使用自定义模板
generator = AdvancedLessonGenerator(agent=agent)
success, result = await generator.generate(
    topic="Python列表推导式",
    template_path="/path/to/custom_template.docx"
)
```

### 自定义输出目录

```python
# 指定输出目录
success, result = await generator.generate(
    topic="Python列表推导式",
    output_dir="/path/to/output"
)
```

---

## 🔍 常见问题

### Q1: 如何确保生成的内容质量？

A: 系统使用以下策略保证质量：
1. **分组生成** - 按逻辑顺序生成，后续内容参考前面已生成的内容
2. **上下文传递** - 基本信息（课程名称、章节）会传递给所有字段
3. **专业提示词** - 每个字段都有详细的生成说明
4. **格式要求** - 明确要求使用数字编号、条理清晰

### Q2: 生成时间需要多久？

A: 
- 51个字段，每个字段约2-5秒
- 总时间约 3-5 分钟
- 可在控制台查看实时进度

### Q3: 可以修改生成的内容吗？

A: 可以！生成的是标准Word文档，您可以：
1. 直接在Word中编辑
2. 修改任何不满意的内容
3. 调整格式和布局

### Q4: 如何处理生成失败？

A: 系统有完善的错误处理：
1. **单个字段失败** - 填充 "[待填充: 字段说明]"
2. **网络问题** - 自动重试
3. **API额度** - 提示明确的错误信息

### Q5: 模板格式会被破坏吗？

A: 不会！系统只替换文本内容，保留：
- 表格结构
- 字体样式
- 段落格式
- 图片和Logo
- 页眉页脚

---

## 📝 最佳实践

### 1. 主题命名建议

✅ 好的主题：
- "Python列表推导式"
- "市场营销中的SWOT分析"
- "数据库的事务管理"

❌ 避免：
- "Python" （太宽泛）
- "列表推导式的语法、应用、优缺点、案例..." （太长）

### 2. 模板准备

确保模板中：
- 所有占位符格式正确：`{{placeholder_name}}`
- 占位符名称与系统支持的一致
- 表格结构清晰
- 格式统一

### 3. 结果检查

生成后建议检查：
- [ ] 所有占位符都已替换
- [ ] 内容逻辑连贯
- [ ] 专业术语准确
- [ ] 符合您的教学风格

### 4. 个性化调整

生成的内容是基础版本，建议：
- 根据学生特点调整难度
- 添加具体的案例
- 补充本校特色内容
- 融入您的教学经验

---

## 🎓 进阶用法

### 批量生成

```python
topics = [
    "Python列表推导式",
    "Python装饰器",
    "Python异常处理"
]

for topic in topics:
    success, result = await generator.generate(topic)
    print(f"{topic}: {'✓' if success else '✗'}")
```

### 自定义占位符说明

```python
generator = AdvancedLessonGenerator(agent=agent)

# 修改占位符说明
generator.PLACEHOLDER_DESCRIPTIONS['custom_field'] = '自定义字段说明'

# 执行生成
success, result = await generator.generate(topic)
```

---

## 📞 技术支持

如遇问题，请检查：

1. **API Key** - 确保已配置 `DASHSCOPE_API_KEY`
2. **模板文件** - 确认 `标注教案.docx` 存在
3. **网络连接** - 需要访问通义千问API
4. **权限问题** - 确保有写入exports目录的权限

查看详细日志：
```bash
python advanced_gen.py "主题" 2>&1 | tee generation.log
```

---

## 📈 版本历史

**v1.0** (2024-10-16)
- ✨ 首次发布
- 🎯 支持51个标准占位符
- 🤖 集成通义千问AI
- 📄 保持Word格式
- 🚀 命令行工具和API

---

**提示**: 本功能是 EduAgent智教创想 的高级特性，旨在帮助教师快速生成高质量教案大纲，实际使用时建议结合个人教学经验进行调整和完善。

