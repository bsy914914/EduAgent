# 🤖 AI模板自动标注工具

## 功能介绍

这是一个AI驱动的教案模板自动标注工具，可以智能识别Word模板中的可填充字段，并自动添加`{{placeholder}}`占位符标签。

### 主要功能

- 🔍 **智能识别字段**：自动识别课程名称、教学目标、教学过程等教案字段
- 🏷️ **自动添加标签**：为识别的字段添加`{{placeholder}}`格式的占位符
- 🎨 **可视化标记**：用红色文字标记已标注的占位符，便于检查
- 📋 **生成说明文档**：自动生成详细的标注说明，列出所有识别的字段
- 🤖 **AI增强**：使用大语言模型辅助字段识别，提高准确率

### 支持的字段类型

工具可以识别以下类型的教案字段：

#### 基本信息
- 课程名称、授课教师、授课班级
- 授课章节、课时、授课时间
- 授课地点、教学场所

#### 教学目标
- 知识目标、能力目标、思政目标
- 素质目标、德育目标

#### 教学重难点
- 教学重点、教学难点、教学关键

#### 教学方法与手段
- 教学方法、学法、教学手段
- 教具、实验器材

#### 教学过程
- 课前预习、课前准备、导入
- 教学过程、教学步骤、教学环节
- 课堂活动、实践活动、讨论问题
- 案例分析、例题讲解、练习题

#### 课后环节
- 课程小结、课后作业、课后思考
- 拓展延伸

#### 其他
- 板书设计、教学反思、备注、参考资料

---

## 使用方法

### 方式一：自动选择（推荐用于后端调试）

直接运行脚本，会自动选择当前目录下的第一个`.docx`文件：

```bash
python debug_annotate_template.py
```

### 方式二：指定文件

通过命令行参数指定要标注的模板文件：

```bash
python debug_annotate_template.py "教案模版.docx"
```

---

## 输出文件

工具会生成两个文件：

### 1. 标注后的模板
- **文件名**：`原文件名_已标注.docx`
- **内容**：原模板的所有内容，识别的字段处添加了红色的`{{placeholder}}`标签

### 2. 标注说明文档
- **文件名**：`原文件名_已标注_标注说明.txt`
- **内容**：详细列出识别的所有字段、占位符名称、位置信息

---

## 工作流程

```
1. 加载模板
   └─> 读取Word文档

2. 分析结构
   ├─> 遍历段落
   ├─> 遍历表格
   └─> 识别字段标签

3. AI增强识别
   └─> 使用大语言模型验证和补充字段

4. 应用标注
   ├─> 为标签行添加占位符
   ├─> 为内容行替换为占位符
   └─> 标记为红色文字

5. 保存文件
   ├─> 保存标注后的模板
   └─> 生成标注说明文档
```

---

## 示例输出

### 标注前
```
课程名称：
授课教师：
授课班级：
```

### 标注后
```
课程名称： {{course_name}}  (红色)
授课教师： {{teacher_name}}  (红色)
授课班级： {{teaching_class}}  (红色)
```

---

## 后续处理

标注完成后，建议按以下步骤处理：

1. **检查标注结果**
   - 打开`_已标注.docx`文件
   - 检查红色标记的占位符是否准确
   - 查看`_标注说明.txt`了解详细信息

2. **手动调整**
   - 修正识别错误的字段
   - 删除不需要的占位符
   - 添加遗漏的占位符

3. **部署使用**
   - 将调整后的模板保存
   - 上传到`templates_library/`目录
   - 在高级生成功能中选择使用

---

## 技术实现

### 核心模块
- `core/template_annotator.py`：模板标注器核心类
- `debug_annotate_template.py`：命令行调试工具

### 字段识别算法
1. **关键词匹配**：基于预定义的字段映射表
2. **位置判断**：分析文本位置（段落/表格）
3. **格式分析**：识别冒号、短文本等特征
4. **AI辅助**：使用LLM验证和补充

### 占位符命名规则
- 使用英文小写字母和下划线
- 语义化命名，如`course_name`、`teaching_goals`
- 与高级生成模块保持一致

---

## 注意事项

⚠️ **重要提示**

1. **备份原文件**
   - 工具会生成新文件，但建议备份原模板

2. **检查标注结果**
   - AI识别可能不是100%准确
   - 务必人工检查并调整

3. **占位符格式**
   - 必须使用双大括号：`{{placeholder}}`
   - 不要在占位符内添加空格

4. **Word格式**
   - 只支持`.docx`格式（不支持`.doc`）
   - 复杂表格可能需要手动调整

5. **中文文件名**
   - 支持中文文件名
   - 建议使用相对路径

---

## 集成到系统

标注好的模板可以直接用于高级生成功能：

```python
# 在Flask后端
from core.advanced_generator import AdvancedLessonGenerator

# 使用标注好的模板
generator = AdvancedLessonGenerator(
    agent=agent,
    template_path="templates_library/标注教案.docx"
)

result = generator.generate(topic="数据结构与算法")
```

---

## 调试输出

工具运行时会显示详细的进度信息：

```
🤖 开始AI自动标注教案模板
================================================================================
📄 加载模板: 教案模版.docx
🔍 分析模板结构...
📊 模板分析结果:
  - 段落数: 20
  - 表格数: 1
  - 识别的字段数: 62
🤖 使用AI增强字段识别...
✨ AI增强后识别的字段数: 62
📝 开始标注模板...
✅ 成功标注 62 个字段
💾 已保存标注模板
📋 已生成标注说明
🎉 模板标注完成！
```

---

## 常见问题

### Q1: 为什么有些字段没有被识别？
**A**: 可能是字段名称不在预定义列表中。你可以：
- 手动添加占位符
- 或在`FIELD_MAPPINGS`中添加新的字段映射

### Q2: 识别的字段太多，有重复怎么办？
**A**: 在手动检查阶段删除重复或不需要的占位符即可。

### Q3: 可以自定义占位符名称吗？
**A**: 可以。标注后手动编辑模板，修改占位符名称。

### Q4: AI分析需要多长时间？
**A**: 通常10-30秒，取决于模板复杂度和网络速度。

### Q5: 标注后的模板可以直接使用吗？
**A**: 建议先检查和调整，确保准确无误后再使用。

---

## 未来改进

- [ ] 支持更多字段类型的自动识别
- [ ] 提供图形化界面（Web UI）
- [ ] 支持批量标注多个模板
- [ ] 添加占位符冲突检测
- [ ] 支持自定义字段映射规则

---

## 许可证

本工具为EduAgent智教创想项目的一部分，仅供学习和研究使用。

---

**EduAgent智教创想** - 让教学内容创作更简单、更高效！ 🎓✨

